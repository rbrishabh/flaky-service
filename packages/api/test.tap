1..80
not ok 1 "before all" hook in "{root}"
  done() called multiple times in hook <"before all" hook> (of root suite); in addition, done() received error: Error: listen EADDRINUSE: address already in use 0.0.0.0:3000
      at Server.setupListenHandle [as _listen2] (net.js:1313:16)
      at listenInCluster (net.js:1361:12)
      at doListen (net.js:1498:7)
      at processTicksAndRejections (internal/process/task_queues.js:85:21) {
    code: 'EADDRINUSE',
    errno: 'EADDRINUSE',
    syscall: 'listen',
    address: '0.0.0.0',
    port: 3000,
    uncaught: true
  }
  Error: done() called multiple times in hook <"before all" hook> (of root suite); in addition, done() received error: Error: listen EADDRINUSE: address already in use 0.0.0.0:3000
      at Server.setupListenHandle [as _listen2] (net.js:1313:16)
      at listenInCluster (net.js:1361:12)
      at doListen (net.js:1498:7)
      at processTicksAndRejections (internal/process/task_queues.js:85:21) {
    code: 'EADDRINUSE',
    errno: 'EADDRINUSE',
    syscall: 'listen',
    address: '0.0.0.0',
    port: 3000,
    uncaught: true
  }
      at process._fatalException (internal/process/execution.js:165:25)
ok 1 Add-Build add-build Can add a build and repository to a blank collection
BUIDLS>DATA: 1
ok 2 Add-Build add-build Can add a different build with overlapping test cases and update repo info
ok 3 Add-Build add-build Can add a third build with some new test cases, add same thing multiple times
not ok 4 Add-Build GetRepoHandler Can get limit and sort by date
  Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m 'uxhh85vqqn'
  [31m-[39m '33333'
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m 'uxhh85vqqn'
  [31m-[39m '33333'
      at Context.<anonymous> (test/addbuild-getbuild.js:258:14)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 5 Add-Build GetRepoHandler Can use offset when getting builds
  Expected values to be strictly equal:
  
  22 !== 2
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  22 !== 2
  
      at Context.<anonymous> (test/addbuild-getbuild.js:272:14)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 6 Add-Build GetRepoHandler Can use random combinations of queries
  Expected values to be strictly equal:
  
  0 !== 2
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 2
  
      at Context.<anonymous> (test/addbuild-getbuild.js:281:14)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 7 Add-Build GetTestHandler Can get limit and sort by date
  Cannot read property 'length' of undefined
  TypeError: Cannot read property 'length' of undefined
      at Context.<anonymous> (test/addbuild-getbuild.js:299:40)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 8 Add-Build GetTestHandler Can use random combinations of queries
  Cannot read property 'length' of undefined
  TypeError: Cannot read property 'length' of undefined
      at Context.<anonymous> (test/addbuild-getbuild.js:310:40)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
ok 9 Add-Build GetTestHandler Can Handle Malformed requests
ok 10 Add-Build GetTestHandler Can Handle length 0 request
not ok 11 Add-Build GetTestHandler Can return all tests in the right order
  The expression evaluated to a falsy value:
  
    assert(ansObj[0].name === 'a/5' || ansObj[0].name === 'a/2')
  
  AssertionError [ERR_ASSERTION]: The expression evaluated to a falsy value:
  
    assert(ansObj[0].name === 'a/5' || ansObj[0].name === 'a/2')
  
      at Context.<anonymous> (test/addbuild-getbuild.js:339:7)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
ok 12 Add-Build GetTestHandler Can use offset and limit parameter for tests
not ok 13 Add-Build GetBuildHandler Can get a particular build
  Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m undefined
  [31m-[39m '789'
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m undefined
  [31m-[39m '789'
      at Context.<anonymous> (test/addbuild-getbuild.js:370:14)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
ok 14 Add-Build GetBuildHandler Can get a nonexistant build
ok 15 Add-Build GetBuildHandler Can get a nonexistant repo
not ok 16 Add-Build GetExportHandler Can get a csv export
  Expected values to be strictly equal:
  
  23 !== 4
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  23 !== 4
  
      at Context.<anonymous> (test/addbuild-getbuild.js:402:14)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 17 Add-Build GetExportHandler Can handle exports with tricky matrix parameter
  Expected values to be strictly equal:
  
  23 !== 5
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  23 !== 5
  
      at Context.<anonymous> (test/addbuild-getbuild.js:445:14)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
ok 18 Add-Build Duplicate Addbuild Can add two builds with the same id and treat them differently
ok 19 Add-Build deleter Can delete a particular test
ok 20 Add-Build deleter Can delete an entire repository
ok 21 Flaky-Analytics Getting Flaky vals Should track stats for a repository
ok 22 Flaky-Analytics Getting Flaky vals Should track stats for builds
ok 23 Flaky-Analytics Getting Flaky vals Should track stats for tests
ok 24 Flaky-Analytics Getting Flaky vals Can add builds non chronologically
ok 25 Auth retrieveAccessToken sends the correct data to Github
ok 26 Auth retrieveUserLogin retrieves the user login using the correct auth token
ok 27 Auth retrieveUserPermission retrieves the user permission using the correct auth token
ok 28 Getting Repos and Orgs should respond with an empty list with random queries
not ok 29 Getting Repos and Orgs should return all results no matter the next characters
  Expected values to be strictly equal:
  
  0 !== 4
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 4
  
      at Context.<anonymous> (test/get-repoorgs-test.js:76:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
ok 30 Getting Repos and Orgs should not work with a name too long
not ok 31 Getting Repos and Orgs find all repos for one org
  Expected values to be strictly equal:
  
  0 !== 4
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 4
  
      at Context.<anonymous> (test/get-repoorgs-test.js:88:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 32 Getting Repos and Orgs can sort within org based on date
  Expected values to be strictly equal:
  
  0 !== 4
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 4
  
      at Context.<anonymous> (test/get-repoorgs-test.js:97:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 33 Getting Repos and Orgs can sort within org based on priority
  Expected values to be strictly equal:
  
  0 !== 4
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 4
  
      at Context.<anonymous> (test/get-repoorgs-test.js:106:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 34 Getting Repos and Orgs can sort within org by name
  Expected values to be strictly equal:
  
  0 !== 4
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 4
  
      at Context.<anonymous> (test/get-repoorgs-test.js:115:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 35 Getting Repos and Orgs still orders by name if startswith parameter
  Expected values to be strictly equal:
  
  0 !== 4
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 4
  
      at Context.<anonymous> (test/get-repoorgs-test.js:124:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 36 Getting Repos and Orgs can use offset parameters on org sesarch
  Expected values to be strictly equal:
  
  0 !== 2
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 2
  
      at Context.<anonymous> (test/get-repoorgs-test.js:133:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 37 Getting Repos and Orgs can correctly use hasnext when there is more
  Expected values to be strictly equal:
  
  0 !== 1
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 1
  
      at Context.<anonymous> (test/get-repoorgs-test.js:142:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 38 Getting Repos and Orgs limit search (only on repos)
  Expected values to be strictly equal:
  
  0 !== 3
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 3
  
      at Context.<anonymous> (test/get-repoorgs-test.js:149:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 39 Getting Repos and Orgs should return all with no startswith
  Expected values to be strictly equal:
  
  0 !== 4
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 4
  
      at Context.<anonymous> (test/get-repoorgs-test.js:155:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 40 Getting Repos and Orgs should work with case insensitive
  Expected values to be strictly equal:
  
  0 !== 1
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  0 !== 1
  
      at Context.<anonymous> (test/get-repoorgs-test.js:161:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
ok 41 Library Functions FirebaseEncode works
not ok 42 Getting Repos and Orgs paginate forward and backwards with a search string
  Expected values to be strictly equal:
  
  2 !== 0
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  2 !== 0
  
      at assertQueryResults (test/paginate-query-test.js:38:10)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
      at async Context.<anonymous> (test/paginate-query-test.js:69:5)
not ok 43 Getting Repos and Orgs paginate forward and backwards without a search string
  Expected values to be strictly equal:
  
  2 !== 0
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  2 !== 0
  
      at assertQueryResults (test/paginate-query-test.js:38:10)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
      at async Context.<anonymous> (test/paginate-query-test.js:78:5)
not ok 44 Getting Repos and Orgs handle a single result
  Expected values to be strictly equal:
  
  1 !== 0
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  1 !== 0
  
      at assertQueryResults (test/paginate-query-test.js:38:10)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
      at async Context.<anonymous> (test/paginate-query-test.js:86:5)
ok 45 Getting Repos and Orgs returns empty list if out of bounds
ok 46 Getting Repos and Orgs errors if incorrect request
ok 47 Posting Builds should be able to parse a TAP file with errors and extract error messages
ok 48 Posting Builds should parse a mangled TAP file without breaking 
ok 49 Posting Builds should handle a test with a not flat structure and repeated tests
ok 50 Posting Builds should handle a test with other stuff at the top
ok 51 Posting Builds should send back an error code when being sent invalid metadata
not ok 52 Posting Builds should send back an error code if token is incorrect
  Expected values to be strictly equal:
  
  500 !== 401
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  500 !== 401
  
      at Context.<anonymous> (test/post-build-test.js:138:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 53 Posting Builds it can post without a description
  Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m undefined
  [31m-[39m 'successfully added build'
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m undefined
  [31m-[39m 'successfully added build'
      at Context.<anonymous> (test/post-build-test.js:155:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 54 Posting Builds should not post data for private repos
  Expected values to be strictly equal:
  
  500 !== 401
  
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  
  500 !== 401
  
      at Context.<anonymous> (test/post-build-test.js:170:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 55 Posting Builds it responds to a valid POST on the /build path with valid token
  Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m undefined
  [31m-[39m 'successfully added build'
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m undefined
  [31m-[39m 'successfully added build'
      at Context.<anonymous> (test/post-build-test.js:180:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 56 Posting Builds it should be able to post data already formatted to /build/gh/v1
  Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m undefined
  [31m-[39m 'successfully added build'
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m undefined
  [31m-[39m 'successfully added build'
      at Context.<anonymous> (test/post-build-test.js:247:12)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
ok 57 Repository createDoc creates a new document
ok 58 Repository getDoc gets a document that exists
ok 59 Repository getDoc returns null when a document does not exist
ok 60 Repository getCollection retrieves the contents of a collection
ok 61 Repository getCollection returns empty array if the collection does not exist
ok 62 Repository ticket handlers storeTicket stores a ticket which has a state
ok 63 Repository ticket handlers getTicket retrieves a ticket by its state
ok 64 Repository allowedToPerformTicket returns true when user has write permission to repo and attempts to delete a test
ok 65 Repository allowedToPerformTicket returns true when user has admin permission to repo and attempts to delete a test
ok 66 Repository allowedToPerformTicket returns false when user has write permission to repo and attempts to delete a repo
ok 67 Repository allowedToPerformTicket returns true when user has admin permission to repo and attempts to delete a repo
ok 68 Repository performTicketIfAllowed deletes test if permitted
ok 69 Repository performTicketIfAllowed does not delete test if not permitted
ok 70 Repository performTicketIfAllowed deletes repo if permitted
ok 71 Repository performTicketIfAllowed does not delete repo if not permitted
ok 72 flaky express server should have the mocked environment variables
ok 73 flaky express server it returns a single repository, when you call GET on /repository/:id # SKIP -
ok 74 flaky express server it creates a repository, when you call POST on /repository # SKIP -
ok 75 flaky express server get /repo to delete a test generates a GitHub redirect
not ok 76 flaky express server get /repo to delete a test stores correct information in the ticket
  The expression evaluated to a falsy value:
  
    assert(stubbed.calledWithMatch({
      action: 'delete-test',
      orgName: 'my-org',
      repoId: 'my-repo',
      testName: 'my-test',
      redirect: process.env.FRONTEND_URL
    }))
  
  AssertionError [ERR_ASSERTION]: The expression evaluated to a falsy value:
  
    assert(stubbed.calledWithMatch({
      action: 'delete-test',
      orgName: 'my-org',
      repoId: 'my-repo',
      testName: 'my-test',
      redirect: process.env.FRONTEND_URL
    }))
  
      at Context.<anonymous> (test/server-test.js:60:7)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 77 flaky express server get /repo to delete a repository generates a GitHub redirect
  The expression evaluated to a falsy value:
  
    assert(respJSON.includes('github.com/login/oauth'))
  
  AssertionError [ERR_ASSERTION]: The expression evaluated to a falsy value:
  
    assert(respJSON.includes('github.com/login/oauth'))
  
      at Context.<anonymous> (test/server-test.js:77:7)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 78 flaky express server get /repo to delete a repository stores correct information in the ticket
  The expression evaluated to a falsy value:
  
    assert(stubbed.calledWithMatch({
      action: 'delete-repo',
      orgName: 'my-org',
      repoId: 'my-repo',
      redirect: process.env.FRONTEND_URL
    }))
  
  AssertionError [ERR_ASSERTION]: The expression evaluated to a falsy value:
  
    assert(stubbed.calledWithMatch({
      action: 'delete-repo',
      orgName: 'my-org',
      repoId: 'my-repo',
      redirect: process.env.FRONTEND_URL
    }))
  
      at Context.<anonymous> (test/server-test.js:88:7)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 79 flaky express server /callback completes the authentication dance
  Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m 'http://0.0.0.0:3000/api/undefined'
  [31m-[39m 'https://flaky-dashboard.web.app/home;done=true'
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m 'http://0.0.0.0:3000/api/undefined'
  [31m-[39m 'https://flaky-dashboard.web.app/home;done=true'
      at Context.<anonymous> (test/server-test.js:118:14)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
not ok 80 flaky express server /callback redirects to the flaky-dev home page when the state is wrong
  Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m 'http://0.0.0.0:3000/api/undefined'
  [31m-[39m 'https://flaky-dashboard.web.app/home'
         ^
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  [32m+ actual[39m [31m- expected[39m
  
  [32m+[39m 'http://0.0.0.0:3000/api/undefined'
  [31m-[39m 'https://flaky-dashboard.web.app/home'
         ^
      at Context.<anonymous> (test/server-test.js:126:14)
      at runMicrotasks (<anonymous>)
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
# tests 79
# pass 45
# fail 34
